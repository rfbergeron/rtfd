# Makefile, Author: Robert Bergeron

WARN = -Wall -Wextra -Werror -Wpedantic -Wshadow
# full gcc exec command
C = gcc -g -std=c11 -msse -msse2 -msse3
GLU = -lglut -lGL -lGLU
CWARN = ${C} ${WARN} -fdiagnostics-color=never
CDEP = gcc -std=c11 -MM ${WARN}
CDBG = ${C} -Og -pg -fsanitize=address
MKFILE = Makefile
DEPFILE = ${MKFILE}.dep
GMAKE = ${MAKE} --no-print-directory
# name of the compiled executable
EXECNAME = demo
# .c source files
SRC = auxlib.c solver.c demo.c
# .h header files
HDR = auxlib.h
# .o object files
OBJ = ${SRC:.c=.o}
# is asm files
ASM = ${SRC:.c=.s}
# .gch some garbage generated by gcc
GCH = ${HDR:=.gch}
# files generated by GNU Indent
FMT = ${SRC:=~} ${HDR:=~}
# convenient groups
ALLSRC = ${SRC}
ALLHDR = ${HDR}

all : ${DEPFILE} ${EXECNAME}

${EXECNAME} : ${OBJ}
	${C} -O3 ${GLU} -o demo ${OBJ}

debug : ${OBJ}
	${CDBG} -o demo ${OBJ}

asm : ${ASM}

%.s : %.c
	${C} -S -fno-exceptions $<

%.o : %.c ${ALLHDR}
	${C} -c $< ${ALLHDR}

clean:
	rm -f ${OBJ} ${DEPFILE} ${GCH} ${ASM}

spotless: clean
	rm -f ${EXECNAME} ${FMT} *.output *.out

cleantest:
	rm -f *.str *.tok *.ast *.sym *.oil

again: clean all

ci: 
	git add ${HDR} ${SRC} ${MKFILE} README.md DESIGN.md \
	.gitignore

dep: ${ALLSRC} ${ALLHDR}
	${CDEP} ${ALLSRC} >> ${DEPFILE}

format:
	clang-format --style=Google -i ${SRC} ${HDR}

${DEPFILE} :
	@ touch ${DEPFILE}
	${GMAKE} dep
